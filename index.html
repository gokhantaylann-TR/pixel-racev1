<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAT GAMES | 8-Bit Racer</title>
    <style>
        body { 
            margin: 0; 
            background: #1a1a1a; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            font-family: 'Courier New', monospace; 
            color: white; 
            overflow: hidden; 
            touch-action: manipulation;
        }
        .game-wrapper { position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        canvas { border: 6px solid #333; background: #444; display: block; image-rendering: pixelated; }
        
        .ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; text-shadow: 2px 2px #000; z-index: 10; }
        .brand { position: absolute; top: 15px; right: 20px; text-align: right; z-index: 10;}
        .brand .title { font-size: 16px; font-weight: bold; color: #f1c40f; }
        .brand .author { font-size: 11px; opacity: 0.9; color: #e74c3c; }

        /* KONTROL TUŞLARI */
        .controls {
            display: flex;
            justify-content: space-between;
            width: 400px;
            margin-top: 20px;
            gap: 20px;
        }
        .btn-group { display: flex; gap: 10px; }
        .btn {
            width: 60px;
            height: 60px;
            background: #333;
            border: 3px solid #fff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            user-select: none;
            border-radius: 8px;
            transition: transform 0.1s, background 0.1s;
        }
        .btn:active { transform: scale(0.9); background: #e74c3c; }
        
        #msg { background: rgba(0,0,0,0.7); padding: 5px 15px; border-radius: 5px; margin-top: 10px; cursor: pointer; pointer-events: auto; }
    </style>
</head>
<body>

    <div class="game-wrapper">
        <div class="ui">
            <h2 id="score">SKOR: 0</h2>
            <div id="msg" onclick="startGame()">BAŞLATMAK İÇİN TIKLA</div>
        </div>
        <div class="brand">
            <div class="title">MAT GAMES</div>
            <div class="author">by gokhantaylan</div>
        </div>
        <canvas id="gameCanvas" width="400" height="500"></canvas>
    </div>

    <div class="controls">
        <div class="btn-group">
            <div class="btn" id="btnLeft">◀</div>
            <div class="btn" id="btnRight">▶</div>
        </div>
        <div class="btn" id="btnPause">P</div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreElement = document.getElementById("score");
    const msgElement = document.getElementById("msg");

    let gameRunning = false;
    let paused = false;
    let score = 0;
    let speed = 7;
    let frame = 0;
    
    const ROAD_WIDTH = 260;
    const LANES = 3;
    const LANE_W = ROAD_WIDTH / LANES;

    const player = {
        lane: 1,
        targetX: 0,
        currentX: 0,
        y: 380,
        w: 44,
        h: 75,
        color: "#e74c3c" // GS Kırmızısı
    };

    let enemies = [];

    // GİRİŞ KONTROLLERİ
    const keys = {};
    window.addEventListener("keydown", e => {
        if (!gameRunning) return;
        if (e.code === "KeyP") togglePause();
        if (!paused) {
            if (e.code === "ArrowLeft" && player.lane > 0) player.lane--;
            if (e.code === "ArrowRight" && player.lane < LANES - 1) player.lane++;
        }
    });

    // Buton Kontrolleri
    function setupBtn(id, action) {
        const btn = document.getElementById(id);
        const trigger = (e) => { e.preventDefault(); action(); };
        btn.addEventListener("mousedown", trigger);
        btn.addEventListener("touchstart", trigger);
    }

    setupBtn("btnLeft", () => { if(gameRunning && !paused && player.lane > 0) player.lane--; });
    setupBtn("btnRight", () => { if(gameRunning && !paused && player.lane < LANES - 1) player.lane++; });
    setupBtn("btnPause", () => { if(gameRunning) togglePause(); });

    function togglePause() {
        paused = !paused;
        msgElement.style.display = paused ? "block" : "none";
        msgElement.innerText = "DURAKLATILDI - DEVAM ET";
    }

    function startGame() {
        if (!gameRunning) {
            resetGame();
            gameRunning = true;
            update();
        } else if (paused) {
            paused = false;
            msgElement.style.display = "none";
        }
    }

    function resetGame() {
        score = 0; speed = 7; frame = 0;
        enemies = [];
        player.lane = 1;
        player.currentX = getLaneX(1);
        player.targetX = player.currentX;
        paused = false;
        msgElement.style.display = "none";
        scoreElement.innerText = "SKOR: 0";
    }

    function getLaneX(lane) {
        return (canvas.width / 2 - ROAD_WIDTH / 2) + (lane * LANE_W) + (LANE_W / 2 - player.w / 2);
    }

    function drawCar(x, y, color, isPlayer = false) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y, player.w, player.h);
        
        if(isPlayer) {
            ctx.fillStyle = "#f1c40f"; // GS Sarısı Detay
            ctx.fillRect(x + 5, y + 5, player.w - 10, 5); 
        }

        ctx.fillStyle = "#111"; // Tekerlekler
        ctx.fillRect(x - 4, y + 10, 6, 18);
        ctx.fillRect(x + player.w - 2, y + 10, 6, 18);
        ctx.fillRect(x - 4, y + 50, 6, 18);
        ctx.fillRect(x + player.w - 2, y + 50, 6, 18);

        ctx.fillStyle = "rgba(255,255,255,0.7)"; // Cam
        ctx.fillRect(x + 6, y + 15, player.w - 12, 20);
    }

    function drawRoad() {
        ctx.fillStyle = "#27ae60"; // Çimen
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const roadX = canvas.width / 2 - ROAD_WIDTH / 2;
        ctx.fillStyle = "#34495e"; // Asfalt
        ctx.fillRect(roadX, 0, ROAD_WIDTH, canvas.height);

        ctx.strokeStyle = "#ecf0f1";
        ctx.setLineDash([30, 30]);
        ctx.lineDashOffset = -frame * speed;
        ctx.lineWidth = 4;
        
        for (let i = 1; i < LANES; i++) {
            ctx.beginPath();
            ctx.moveTo(roadX + i * LANE_W, 0);
            ctx.lineTo(roadX + i * LANE_W, canvas.height);
            ctx.stroke();
        }
    }

    function update() {
        if (!gameRunning || paused) {
            if(gameRunning) requestAnimationFrame(update);
            return;
        }

        frame++;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawRoad();

        // Yumuşak Hareket
        player.targetX = getLaneX(player.lane);
        player.currentX += (player.targetX - player.currentX) * 0.2;
        drawCar(player.currentX, player.y, player.color, true);

        if (frame % 50 === 0) {
            enemies.push({ lane: Math.floor(Math.random() * 3), y: -100, color: "#2980b9" });
        }

        enemies.forEach((en, index) => {
            en.y += speed;
            const enX = getLaneX(en.lane);
            drawCar(enX, en.y, en.color);

            if (
                player.currentX < enX + player.w - 5 &&
                player.currentX + player.w - 5 > enX &&
                player.y < en.y + player.h - 5 &&
                player.y + player.h - 5 > en.y
            ) {
                gameOver();
            }

            if (en.y > canvas.height) {
                enemies.splice(index, 1);
                score++;
                scoreElement.innerText = `SKOR: ${score}`;
                if (score % 5 === 0) speed += 0.2;
            }
        });

        requestAnimationFrame(update);
    }

    function gameOver() {
        gameRunning = false;
        msgElement.style.display = "block";
        msgElement.innerText = "OYUN BİTTİ! TEKRARLA";
    }

    drawRoad();
    drawCar(getLaneX(1), player.y, player.color, true);
</script>
</body>
</html>
