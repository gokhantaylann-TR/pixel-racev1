<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>8-Bit Retro Racer</title>

<style>
body {
    margin: 0;
    background: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
    font-family: 'Courier New', Courier, monospace;
    overflow: hidden;
}

.game-wrapper {
    position: relative;
}

canvas {
    border: 4px solid #fff;
    background: #444;
    display: block;
}

.ui {
    position: absolute;
    top: 20px;
    width: 100%;
    text-align: center;
    pointer-events: none;
}

.brand {
    position: absolute;
    top: 15px;
    right: 20px;
    text-align: center;
    pointer-events: none;
}

.brand .title { font-size: 11px; }
.brand .author { font-size: 10px; opacity: 0.8; }

/* ===== ALT KONTROLLER ===== */
.controls {
    position: absolute;
    bottom: -120px;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
}

.control-group {
    display: flex;
    gap: 10px;
}

.btn {
    width: 55px;
    height: 55px;
    border: 3px solid #fff;
    background: #333;
    color: #fff;
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
}

.btn:active {
    background: #666;
}
</style>
</head>

<body>

<div class="game-wrapper">

    <div class="ui">
        <h1 id="score">SKOR: 0</h1>
        <p id="msg">BAŞLAMAK İÇİN TIKLA</p>
    </div>

    <div class="brand">
        <div class="title">MAT GAMES</div>
        <div class="author">by gokhantaylan</div>
    </div>

    <canvas id="gameCanvas" width="400" height="600"></canvas>

    <!-- ALT YÖN TUŞLARI -->
    <div class="controls">
        <div class="control-group">
            <div class="btn" data-key="ArrowLeft">◀</div>
            <div class="btn" data-key="ArrowRight">▶</div>
        </div>
        <div class="control-group">
            <div class="btn" data-key="ArrowUp">▲</div>
            <div class="btn" data-key="ArrowDown">▼</div>
        </div>
    </div>

</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const scoreElement = document.getElementById("score");
const msgElement = document.getElementById("msg");

let gameRunning = false;
let paused = false;
let score = 0;
let speed = 5;
let frame = 0;

const player = {
    x: 180,
    y: 480,
    w: 40,
    h: 70,
    color: "#e74c3c"
};

let enemies = [];
let keys = {};

// KLAVYE
window.addEventListener("keydown", e => {
    keys[e.code] = true;
    if (e.code === "KeyP" && gameRunning) {
        paused = !paused;
        msgElement.innerText = paused ? "PAUSE" : "";
        if (!paused) update();
    }
});
window.addEventListener("keyup", e => keys[e.code] = false);

// DOKUNMATİK TUŞLAR
document.querySelectorAll(".btn").forEach(btn => {
    const key = btn.dataset.key;

    btn.addEventListener("touchstart", () => keys[key] = true);
    btn.addEventListener("touchend", () => keys[key] = false);
    btn.addEventListener("mousedown", () => keys[key] = true);
    btn.addEventListener("mouseup", () => keys[key] = false);
});

// OYUN BAŞLAT
canvas.addEventListener("click", () => {
    if (!gameRunning) resetGame();
});

function resetGame() {
    score = 0;
    speed = 5;
    frame = 0;
    enemies = [];
    paused = false;
    player.x = 180;
    player.y = 480;
    gameRunning = true;
    msgElement.innerText = "";
    update();
}

function spawnEnemy() {
    if (frame % 60 === 0) {
        const lane = Math.floor(Math.random() * 3);
        const x = lane * (canvas.width / 3) + 45;
        enemies.push({ x, y: -80, w: 40, h: 70, color: "#3498db" });
    }
}

function drawCar(o) {
    ctx.fillStyle = o.color;
    ctx.fillRect(o.x, o.y, o.w, o.h);
    ctx.fillStyle = "#000";
    ctx.fillRect(o.x - 5, o.y + 10, 5, 15);
    ctx.fillRect(o.x + o.w, o.y + 10, 5, 15);
}

function drawRoad() {
    ctx.fillStyle = "#555";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function update() {
    if (!gameRunning || paused) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    frame++;
    drawRoad();

    if (keys.ArrowLeft && player.x > 0) player.x -= 6;
    if (keys.ArrowRight && player.x < canvas.width - player.w) player.x += 6;
    if (keys.ArrowUp && player.y > 0) player.y -= 5;
    if (keys.ArrowDown && player.y < canvas.height - player.h) player.y += 5;

    drawCar(player);
    spawnEnemy();

    enemies.forEach((e, i) => {
        e.y += speed;
        drawCar(e);

        if (
            player.x < e.x + e.w &&
            player.x + player.w > e.x &&
            player.y < e.y + e.h &&
            player.y + player.h > e.y
        ) gameOver();

        if (e.y > canvas.height) {
            enemies.splice(i, 1);
            score++;
            scoreElement.innerText = "SKOR: " + score;
        }
    });

    requestAnimationFrame(update);
}

function gameOver() {
    gameRunning = false;
    msgElement.innerText = "OYUN BİTTİ - TIKLA";
}

drawRoad();
drawCar(player);
</script>

</body>
</html>