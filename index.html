<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAT GAMES | 8-Bit Pro Edition</title>
    <style>
        body { 
            margin: 0; background: #050505; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            height: 100vh; font-family: 'Courier New', monospace; color: white; 
            overflow: hidden; touch-action: manipulation;
        }
        .game-wrapper { position: relative; box-shadow: 0 0 80px rgba(0,0,0,1); }
        canvas { border: 4px solid #1a1a1a; background: #222; display: block; image-rendering: pixelated; }
        
        .ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; text-shadow: 2px 2px #000; z-index: 10; }
        .brand { position: absolute; top: 15px; right: 20px; text-align: right; z-index: 10;}
        .brand .title { font-size: 18px; font-weight: bold; color: #00d2ff; font-style: italic; letter-spacing: 2px; }
        .brand .author { font-size: 10px; opacity: 0.7; color: #fff; }

        .controls { display: flex; justify-content: space-between; width: 400px; margin-top: 25px; gap: 20px; }
        .btn-group { display: flex; gap: 15px; }
        .btn { 
            width: 75px; height: 75px; background: #111; border: 2px solid #333; 
            color: #555; display: flex; align-items: center; justify-content: center; 
            font-size: 32px; cursor: pointer; user-select: none; border-radius: 50%;
            transition: all 0.2s;
        }
        .btn:active { background: #00d2ff; color: #fff; border-color: #fff; transform: scale(0.9); }
        
        #msg { 
            background: rgba(0,0,0,0.95); padding: 15px 30px; border-radius: 4px; 
            margin-top: 10px; cursor: pointer; pointer-events: auto; border-left: 5px solid #00d2ff;
            font-weight: bold; font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="game-wrapper">
        <div class="ui">
            <h2 id="score">SCORE: 0</h2>
            <div id="msg" onclick="startGame()">START ENGINE</div>
        </div>
        <div class="brand">
            <div class="title">MAT GAMES</div>
            <div class="author">by gokhantaylan</div>
        </div>
        <canvas id="gameCanvas" width="400" height="550"></canvas>
    </div>

    <div class="controls">
        <div class="btn-group">
            <div id="btnLeft" class="btn">◀</div>
            <div id="btnRight" class="btn">▶</div>
        </div>
        <div id="btnPause" class="btn" style="border-radius: 10px;">P</div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreElement = document.getElementById("score");
    const msgElement = document.getElementById("msg");

    let gameRunning = false, paused = false, score = 0, speed = 9, frame = 0;
    const ROAD_W = 280, LANES = 3, LANE_W = ROAD_W / LANES;

    // Modeller
    const MODELS = { SKYLINE: 'skyline', CHARGER: 'charger', SUPRA: 'supra', S2000: 's2000' };
    const player = { lane: 1, currentX: 0, targetX: 0, y: 420, w: 44, h: 80, model: MODELS.SKYLINE };
    let enemies = [];
    const enemyPool = [MODELS.CHARGER, MODELS.SUPRA, MODELS.S2000];

    // --- SES SENTEZLEYİCİ ---
    let audioCtx, osc, gain;
    function initSound() {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        osc = audioCtx.createOscillator(); gain = audioCtx.createGain();
        osc.type = 'sawtooth'; osc.connect(gain); gain.connect(audioCtx.destination);
        gain.gain.value = 0; osc.start();
    }
    function updateSound() {
        if (osc && gameRunning && !paused) {
            osc.frequency.setTargetAtTime(40 + (speed * 6), audioCtx.currentTime, 0.1);
            gain.gain.setTargetAtTime(0.02, audioCtx.currentTime, 0.1);
        } else if (gain) gain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
    }

    // --- ÇİZİM MOTORU (DETAYLI GRAFİKLER) ---
    function drawPixelCar(car) {
        const { x, y, w, h, model } = car;
        
        // Gölge
        ctx.fillStyle = "rgba(0,0,0,0.4)";
        ctx.fillRect(x + 4, y + 10, w, h);

        const drawPart = (color, rx, ry, rw, rh) => {
            ctx.fillStyle = color;
            ctx.fillRect(x + rx, y + ry, rw, rh);
        };

        if (model === MODELS.SKYLINE) {
            drawPart("#95a5a6", 2, 0, w-4, h);
            drawPart("#bdc3c7", 4, 2, w-8, h-10);
            drawPart("#2980b9", 10, 0, 5, h-4);
            drawPart("#2980b9", w-15, 0, 5, h-4);
            drawPart("#2c3e50", 6, 20, w-12, 18);
            drawPart("#34495e", 8, 22, w-16, 12);
            drawPart("#7f8c8d", 0, h-8, w, 5);
            drawPart("#2980b9", 0, h-10, 4, 8); drawPart("#2980b9", w-4, h-10, 4, 8);
            ["#e74c3c", "#c0392b"].forEach((c, i) => {
                drawPart(c, 6, h-4, 4, 3); drawPart(c, 14, h-4, 4, 3);
                drawPart(c, w-10, h-4, 4, 3); drawPart(c, w-18, h-4, 4, 3);
            });
        } 
        else if (model === MODELS.CHARGER) {
            drawPart("#111", 0, 0, w, h);
            drawPart("#2c3e50", 4, 4, w-8, h-15);
            drawPart("#bdc3c7", w/2-8, 10, 16, 12);
            drawPart("#7f8c8d", w/2-6, 8, 12, 4);
            drawPart("#ecf0f1", 4, 2, w-8, 2);
            drawPart("#e74c3c", 4, h-4, w-8, 3);
        }
        else if (model === MODELS.SUPRA) {
            drawPart("#e67e22", 2, 0, w-4, h);
            drawPart("#f39c12", 4, 5, w-8, h-20);
            drawPart("#2c3e50", 2, 35, 4, 25); drawPart("#2c3e50", w-6, 35, 4, 25);
            drawPart("#111", 6, 18, w-12, 15);
            drawPart("#d35400", 0, h-12, w, 6);
            drawPart("#d35400", 2, h-16, 4, 6); drawPart("#d35400", w-6, h-16, 4, 6);
        }
        else if (model === MODELS.S2000) {
            drawPart("#fd79a8", 2, 0, w-4, h);
            drawPart("#f8a5c2", 6, 4, w-12, h-10);
            drawPart("#111", 6, 25, w-12, 25);
            drawPart("#333", 8, 28, w-16, 15);
            drawPart("#fff", 6, 22, w-12, 3);
        }

        ctx.fillStyle = "#000";
        [12, h-22].forEach(ty => { 
            ctx.fillRect(x-2, y+ty, 4, 16); ctx.fillRect(x+w-2, y+ty, 4, 16); 
        });
    }

    function drawRoad() {
        ctx.fillStyle = "#111"; ctx.fillRect(0,0,canvas.width, canvas.height);
        const rX = canvas.width/2 - ROAD_W/2;
        ctx.fillStyle = "#222"; ctx.fillRect(rX, 0, ROAD_W, canvas.height);
        const kH = 30;
        for(let i=-frame%(kH*2); i<canvas.height; i+=kH){
            ctx.fillStyle = (Math.floor((i+frame)/kH)%2===0) ? "#e74c3c" : "#fff";
            ctx.fillRect(rX-10, i, 10, kH);
            ctx.fillRect(rX+ROAD_W, i, 10, kH);
        }
        ctx.strokeStyle = "rgba(255,255,255,0.2)"; ctx.setLineDash([40, 60]); 
        ctx.lineDashOffset = -frame * speed; ctx.lineWidth = 4;
        for(let i=1; i<LANES; i++){
            ctx.beginPath(); ctx.moveTo(rX + i*LANE_W, 0); ctx.lineTo(rX + i*LANE_W, canvas.height); ctx.stroke();
        }
    }

    // --- OYUN MANTIĞI ---
    function update() {
        if (!gameRunning || paused) { updateSound(); if(gameRunning) requestAnimationFrame(update); return; }
        frame++; ctx.clearRect(0,0,canvas.width, canvas.height);
        drawRoad(); updateSound();
        player.targetX = (canvas.width/2 - ROAD_W/2) + (player.lane * LANE_W) + (LANE_W/2 - player.w/2);
        player.currentX += (player.targetX - player.currentX) * 0.2;
        drawPixelCar({ ...player, x: player.currentX });

        if(frame % Math.max(25, 60 - Math.floor(speed)) === 0){
            enemies.push({ 
                lane: Math.floor(Math.random()*LANES), 
                y: -100, w: 44, h: 80, 
                model: enemyPool[Math.floor(Math.random()*enemyPool.length)]
            });
        }

        enemies.forEach((en, i) => {
            en.y += speed;
            en.x = (canvas.width/2 - ROAD_W/2) + (en.lane * LANE_W) + (LANE_W/2 - en.w/2);
            drawPixelCar(en);

            if(player.currentX < en.x+en.w-10 && player.currentX+player.w-10 > en.x &&
               player.y < en.y+en.h-10 && player.y+player.h-10 > en.y) gameOver();

            if(en.y > canvas.height){
                enemies.splice(i, 1); score++; scoreElement.innerText = "SCORE: " + score;
                if(score % 5 === 0) speed += 0.3;
            }
        });

        requestAnimationFrame(update);
    }

    // --- KONTROLLER ---
    function setupInput(id, fn) {
        const el = document.getElementById(id);
        el.addEventListener("touchstart", (e)=>{ e.preventDefault(); fn(); });
        el.addEventListener("mousedown", (e)=>{ e.preventDefault(); fn(); });
    }
    setupInput("btnLeft", () => { if(player.lane > 0) player.lane--; });
    setupInput("btnRight", () => { if(player.lane < 2) player.lane++; });
    setupInput("btnPause", () => { 
        if(gameRunning) { 
            paused = !paused; 
            msgElement.style.display = paused ? "block" : "none"; 
            msgElement.innerText = "PAUSED"; 
        }
    });

    window.addEventListener("keydown", (e) => {
        if(e.code === "ArrowLeft" && player.lane > 0) player.lane--;
        if(e.code === "ArrowRight" && player.lane < 2) player.lane++;
        if(e.code === "KeyP") document.getElementById("btnPause").click();
    });

    function startGame() {
        if(!gameRunning) { if(!audioCtx) initSound(); reset(); gameRunning = true; update(); }
        else if(paused) { paused = false; msgElement.style.display = "none"; }
    }
    function reset() { score = 0; speed = 9; enemies = []; player.lane = 1; msgElement.style.display = "none"; scoreElement.innerText = "SCORE: 0"; }
    function gameOver() { gameRunning = false; msgElement.style.display = "block"; msgElement.innerText = "BUSTED! RESTART"; }

    drawRoad(); drawPixelCar({...player, x: (canvas.width/2 - ROAD_W/2) + (1 * LANE_W) + (LANE_W/2 - player.w/2)});
</script>
</body>
</html>