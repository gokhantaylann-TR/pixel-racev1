<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAT GAMES | 8-Bit Racer</title>
    <style>
        body { 
            margin: 0; background: #1a1a1a; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            height: 100vh; font-family: 'Courier New', monospace; color: white; 
            overflow: hidden; touch-action: manipulation;
        }
        .game-wrapper { position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        canvas { border: 6px solid #333; background: #444; display: block; image-rendering: pixelated; }
        
        .ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; text-shadow: 2px 2px #000; z-index: 10; }
        .brand { position: absolute; top: 15px; right: 20px; text-align: right; z-index: 10;}
        .brand .title { font-size: 16px; font-weight: bold; color: #f1c40f; }
        .brand .author { font-size: 11px; opacity: 0.9; color: #e74c3c; }

        .controls { display: flex; justify-content: space-between; width: 400px; margin-top: 20px; gap: 20px; }
        .btn-group { display: flex; gap: 10px; }
        .btn { 
            width: 70px; height: 70px; background: #333; border: 4px solid #fff; 
            color: white; display: flex; align-items: center; justify-content: center; 
            font-size: 28px; cursor: pointer; user-select: none; border-radius: 12px;
        }
        .btn:active { background: #e74c3c; transform: scale(0.95); }
        
        #msg { 
            background: rgba(0,0,0,0.85); padding: 15px 25px; border-radius: 8px; 
            margin-top: 10px; cursor: pointer; pointer-events: auto; border: 2px solid #f1c40f;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="game-wrapper">
        <div class="ui">
            <h2 id="score">SKOR: 0</h2>
            <div id="msg" onclick="startGame()">GAZA BASMAK İÇİN TIKLA</div>
        </div>
        <div class="brand">
            <div class="title">MAT GAMES</div>
            <div class="author">by gokhantaylan</div>
        </div>
        <canvas id="gameCanvas" width="400" height="500"></canvas>
    </div>

    <div class="controls">
        <div class="btn-group">
            <div class="btn" id="btnLeft">◀</div>
            <div class="btn" id="btnRight">▶</div>
        </div>
        <div class="btn" id="btnPause">P</div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreElement = document.getElementById("score");
    const msgElement = document.getElementById("msg");

    let gameRunning = false, paused = false, score = 0, speed = 7, frame = 0;
    const ROAD_WIDTH = 260, LANES = 3, LANE_W = ROAD_WIDTH / LANES;

    // Oyuncu Aracı (GS Renkleri: Kırmızı Gövde, Sarı Detay)
    const player = { lane: 1, targetX: 0, currentX: 0, y: 380, w: 44, h: 75, color: "#e74c3c" };
    let enemies = [];

    // --- 8-BIT SES MOTORU ---
    let audioCtx, oscillator, gainNode;

    function initEngineSound() {
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            oscillator = audioCtx.createOscillator();
            gainNode = audioCtx.createGain();
            oscillator.type = 'sawtooth';
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            gainNode.gain.value = 0.04; 
            oscillator.start();
        } catch(e) { console.log("Ses başlatılamadı."); }
    }

    function updateEnginePitch() {
        if (oscillator && !paused && gameRunning) {
            // Hız arttıkça ses incelir (RPM artışı efekti)
            oscillator.frequency.setTargetAtTime(45 + (speed * 4), audioCtx.currentTime, 0.1);
            gainNode.gain.setTargetAtTime(0.04, audioCtx.currentTime, 0.1);
        } else if (gainNode) {
            gainNode.gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
        }
    }

    // --- KONTROLLER ---
    window.addEventListener("keydown", e => {
        if (!gameRunning) return;
        if (e.code === "KeyP") togglePause();
        if (!paused) {
            if (e.code === "ArrowLeft" && player.lane > 0) player.lane--;
            if (e.code === "ArrowRight" && player.lane < LANES - 1) player.lane++;
        }
    });

    function setupBtn(id, action) {
        const btn = document.getElementById(id);
        const handle = (e) => { e.preventDefault(); action(); };
        btn.addEventListener("mousedown", handle);
        btn.addEventListener("touchstart", handle);
    }
    setupBtn("btnLeft", () => { if(gameRunning && !paused && player.lane > 0) player.lane--; });
    setupBtn("btnRight", () => { if(gameRunning && !paused && player.lane < LANES - 1) player.lane++; });
    setupBtn("btnPause", () => { if(gameRunning) togglePause(); });

    function togglePause() {
        paused = !paused;
        msgElement.style.display = paused ? "block" : "none";
        msgElement.innerText = "DURAKLATILDI - DEVAM ET";
    }

    function startGame() {
        if (!gameRunning) {
            if(!audioCtx) initEngineSound();
            resetGame();
            gameRunning = true;
            update();
        } else if (paused) {
            paused = false;
            msgElement.style.display = "none";
        }
    }

    function resetGame() {
        score = 0; speed = 7; frame = 0; enemies = []; player.lane = 1;
        player.currentX = getLaneX(1); player.targetX = player.currentX;
        paused = false; msgElement.style.display = "none";
        scoreElement.innerText = "SKOR: 0";
    }

    function getLaneX(lane) { return (canvas.width / 2 - ROAD_WIDTH / 2) + (lane * LANE_W) + (LANE_W / 2 - player.w / 2); }

    function drawCar(x, y, color, isPlayer = false) {
        // Gövde
        ctx.fillStyle = color;
        ctx.fillRect(x, y, player.w, player.h);
        
        // GS Sarısı Şerit
        if(isPlayer) { 
            ctx.fillStyle = "#f1c40f"; 
            ctx.fillRect(x + 5, y + 8, player.w - 10, 6); 
        }

        // Tekerlekler
        ctx.fillStyle = "#111";
        [12, 52].forEach(wheelY => {
            ctx.fillRect(x - 5, y + wheelY, 6, 16);
            ctx.fillRect(x + player.w - 1, y + wheelY, 6, 16);
        });

        // Cam
        ctx.fillStyle = "rgba(200,230,255,0.8)";
        ctx.fillRect(x + 6, y + 18, player.w - 12, 18);
    }

    function drawRoad() {
        // Yol kenarı (Çimen)
        ctx.fillStyle = "#27ae60"; ctx.fillRect(0, 0, canvas.width, canvas.height); 
        
        const roadX = canvas.width / 2 - ROAD_WIDTH / 2;
        // Asfalt
        ctx.fillStyle = "#34495e"; ctx.fillRect(roadX, 0, ROAD_WIDTH, canvas.height); 

        // Şerit Çizgileri
        ctx.strokeStyle = "#ffffff"; ctx.setLineDash([30, 30]); ctx.lineDashOffset = -frame * speed;
        ctx.lineWidth = 4;
        for (let i = 1; i < LANES; i++) {
            ctx.beginPath(); 
            ctx.moveTo(roadX + i * LANE_W, 0); 
            ctx.lineTo(roadX + i * LANE_W, canvas.height); 
            ctx.stroke();
        }
    }

    function update() {
        if (!gameRunning || paused) {
            updateEnginePitch();
            if(gameRunning) requestAnimationFrame(update);
            return;
        }

        frame++; ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawRoad();
        updateEnginePitch();

        // Yumuşak Geçiş (Lerp)
        player.targetX = getLaneX(player.lane);
        player.currentX += (player.targetX - player.currentX) * 0.18;
        drawCar(player.currentX, player.y, player.color, true);

        // Engel Oluşturma
        if (frame % Math.max(30, 60 - Math.floor(speed)) === 0) {
            enemies.push({ 
                lane: Math.floor(Math.random() * 3), 
                y: -100, 
                color: "#2980b9" 
            });
        }

        enemies.forEach((en, index) => {
            en.y += speed;
            const enX = getLaneX(en.lane);
            drawCar(enX, en.y, en.color);

            // Çarpışma Testi
            if (player.currentX < enX + player.w - 6 && player.currentX + player.w - 6 > enX &&
                player.y < en.y + player.h - 6 && player.y + player.h - 6 > en.y) {
                gameOver();
            }

            // Temizlik ve Skor
            if (en.y > canvas.height) {
                enemies.splice(index, 1);
                score++; scoreElement.innerText = `SKOR: ${score}`;
                if (score % 5 === 0) speed += 0.25;
            }
        });

        requestAnimationFrame(update);
    }

    function gameOver() {
        gameRunning = false;
        msgElement.style.display = "block";
        msgElement.innerText = "KAZA YAPTIN! TEKRAR DENE";
    }

    // İlk Çizim
    drawRoad();
    drawCar(getLaneX(1), player.y, player.color, true);
</script>
</body>
</html>
