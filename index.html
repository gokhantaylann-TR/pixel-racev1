<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>8-Bit Retro Racer</title>

<style>
body{
    margin:0;
    background:#222;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:Courier New, monospace;
    color:#fff;
}
.game-wrapper{position:relative;}
canvas{border:4px solid #fff;display:block;background:#333}

/* UI */
.ui{
    position:absolute;
    top:20px;
    width:100%;
    text-align:center;
    pointer-events:none;
}
.brand{
    position:absolute;
    top:15px;
    right:20px;
    text-align:center;
}
.brand .title{font-size:11px}
.brand .author{font-size:10px;opacity:.8}
</style>
</head>

<body>
<div class="game-wrapper">
    <div class="ui">
        <h1 id="score">SKOR: 0</h1>
        <p id="msg">TIKLA → BAŞLA | P: PAUSE | SHIFT: NITRO</p>
    </div>

    <div class="brand">
        <div class="title">MAT GAMES</div>
        <div class="author">by gokhantaylan</div>
    </div>

    <canvas id="c" width="400" height="600"></canvas>
</div>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");

let frame=0, score=0, speed=4;
let running=false, paused=false, nitro=false;
let keys={};

const ROAD = {
    width:220,
    lanes:3,
    curveAmp:60,
    curveFreq:0.002
};

const player = {
    lane:1,
    y:460,
    w:40,
    h:70,
    color:"#e74c3c"
};

let enemies=[];
let objects=[];

/* INPUT */
window.addEventListener("keydown",e=>{
    keys[e.code]=true;
    if(e.code==="KeyP") paused=!paused;
    if(e.code==="ShiftLeft") nitro=true;
});
window.addEventListener("keyup",e=>{
    keys[e.code]=false;
    if(e.code==="ShiftLeft") nitro=false;
});

c.addEventListener("click",()=>{
    if(!running){ reset(); running=true; loop(); }
});

function reset(){
    frame=0; score=0; speed=4;
    enemies=[]; objects=[];
    player.lane=1;
    paused=false;
}

/* CORE MATH */
function roadCenter(y){
    return c.width/2 + Math.sin(frame*ROAD.curveFreq + y*0.01)*ROAD.curveAmp;
}

function laneX(lane,y){
    const laneW = ROAD.width/ROAD.lanes;
    return roadCenter(y) - ROAD.width/2 + laneW*(lane+0.5);
}

/* DRAW ROAD */
function drawRoad(){
    // grass
    ctx.fillStyle="#2ecc71";
    ctx.fillRect(0,0,c.width,c.height);

    // road
    ctx.fillStyle="#555";
    for(let y=0;y<c.height;y++){
        const scale=y/c.height;
        const w=ROAD.width*(0.5+scale);
        ctx.fillRect(roadCenter(y)-w/2,y,w,1);
    }

    // lane lines
    ctx.strokeStyle="#fff";
    for(let l=1;l<ROAD.lanes;l++){
        ctx.beginPath();
        for(let y=0;y<c.height;y+=10){
            ctx.lineTo(
                roadCenter(y)-ROAD.width/2 + (ROAD.width/ROAD.lanes)*l,
                y
            );
        }
        ctx.stroke();
    }
}

/* CAR */
function drawCar(x,y,scale,color){
    ctx.save();
    ctx.translate(x,y);
    ctx.scale(scale,scale);
    ctx.fillStyle=color;
    ctx.fillRect(-20,-35,40,70);
    ctx.fillStyle="#000";
    ctx.fillRect(-25,-25,5,15);
    ctx.fillRect(20,-25,5,15);
    ctx.restore();
}

/* SPAWN */
function spawnEnemy(){
    if(frame%80===0){
        enemies.push({
            lane:Math.floor(Math.random()*3),
            y:-100
        });
    }
    if(frame%100===0){
        objects.push({
            side:Math.random()<.5?-1:1,
            y:-100
        });
    }
}

/* LOOP */
function loop(){
    if(!running||paused)return;
    frame++;
    const curSpeed = nitro ? speed*1.8 : speed;

    // motion blur
    ctx.fillStyle="rgba(0,0,0,0.2)";
    ctx.fillRect(0,0,c.width,c.height);

    drawRoad();

    // player input
    if(keys.ArrowLeft && player.lane>0) player.lane--;
    if(keys.ArrowRight && player.lane<2) player.lane++;

    // player
    drawCar(
        laneX(player.lane,player.y),
        player.y,
        1,
        player.color
    );

    spawnEnemy();

    // enemies
    enemies.forEach((e,i)=>{
        e.y+=curSpeed;
        const scale = e.y/c.height;
        drawCar(
            laneX(e.lane,e.y),
            e.y,
            scale,
            "#3498db"
        );

        if(e.y>c.height){
            enemies.splice(i,1);
            score++;
            document.getElementById("score").innerText="SKOR: "+score;
        }
    });

    // objects
    objects.forEach((o,i)=>{
        o.y+=curSpeed*1.2;
        const scale=o.y/c.height;
        const x=roadCenter(o.y)+(ROAD.width/2+20)*o.side;
        ctx.fillStyle="#2c3e50";
        ctx.fillRect(x,o.y,6,30*scale);
        if(o.y>c.height) objects.splice(i,1);
    });

    requestAnimationFrame(loop);
}

</script>
</body>
</html>