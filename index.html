<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAT GAMES | Street Racing Pro</title>
    <style>
        body { 
            margin: 0; background: #050505; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            height: 100vh; font-family: 'Courier New', monospace; color: white; 
            overflow: hidden; touch-action: manipulation;
        }
        .game-wrapper { position: relative; box-shadow: 0 0 100px rgba(0,0,0,1); }
        canvas { border: 4px solid #1a1a1a; background: #222; display: block; image-rendering: pixelated; }
        
        .ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; text-shadow: 2px 2px #000; z-index: 10; }
        .brand { position: absolute; top: 15px; right: 20px; text-align: right; z-index: 10;}
        .brand .title { font-size: 20px; font-weight: bold; color: #00d2ff; font-style: italic; letter-spacing: 2px; }
        .brand .author { font-size: 11px; opacity: 0.8; color: #fff; }

        .controls { display: flex; justify-content: space-between; width: 400px; margin-top: 25px; gap: 20px; }
        .btn-group { display: flex; gap: 15px; }
        .btn { 
            width: 75px; height: 75px; background: #111; border: 2px solid #333; 
            color: #777; display: flex; align-items: center; justify-content: center; 
            font-size: 32px; cursor: pointer; user-select: none; border-radius: 50%;
            transition: all 0.2s; box-shadow: 0 5px #000;
        }
        .btn:active { background: #00d2ff; color: #fff; border-color: #fff; transform: translateY(5px); box-shadow: 0 0 #000; }
        
        #msg { 
            background: rgba(0,0,0,0.95); padding: 15px 35px; border-radius: 4px; 
            margin-top: 10px; cursor: pointer; pointer-events: auto; border-left: 5px solid #00d2ff;
            font-weight: bold; font-size: 16px; letter-spacing: 1px;
        }
        #highScore { font-size: 12px; color: #f1c40f; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="game-wrapper">
        <div class="ui">
            <h2 id="score">SCORE: 0</h2>
            <div id="highScore">TOP SCORE: 0</div>
            <div id="msg" onclick="startGame()">START ENGINE</div>
        </div>
        <div class="brand">
            <div class="title">MAT GAMES</div>
            <div class="author">by gokhantaylan</div>
        </div>
        <canvas id="gameCanvas" width="400" height="550"></canvas>
    </div>

    <div class="controls">
        <div class="btn-group">
            <div id="btnLeft" class="btn">◀</div>
            <div id="btnRight" class="btn">▶</div>
        </div>
        <div id="btnPause" class="btn" style="border-radius: 12px;">P</div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreElement = document.getElementById("score");
    const highScoreElement = document.getElementById("highScore");
    const msgElement = document.getElementById("msg");

    // Oyun Ayarları
    let gameRunning = false, paused = false, score = 0, speed = 9, frame = 0;
    const ROAD_W = 280, LANES = 3, LANE_W = ROAD_W / LANES;
    
    // High Score Yükle
    let topScore = localStorage.getItem("matGames_topScore") || 0;
    highScoreElement.innerText = "TOP SCORE: " + topScore;

    // Araba Modelleri
    const MODELS = { SKYLINE: 'skyline', CHARGER: 'charger', SUPRA: 'supra', S2000: 's2000' };
    const player = { lane: 1, currentX: 0, targetX: 0, y: 410, w: 46, h: 84, model: MODELS.SKYLINE };
    let enemies = [];
    const enemyPool = [MODELS.CHARGER, MODELS.SUPRA, MODELS.S2000];

    // --- 8-BIT SES MOTORU ---
    let audioCtx, osc, gain;
    function initSound() {
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            osc = audioCtx.createOscillator(); gain = audioCtx.createGain();
            osc.type = 'sawtooth'; osc.connect(gain); gain.connect(audioCtx.destination);
            gain.gain.value = 0; osc.start();
        } catch(e) {}
    }
    function updateSound() {
        if (osc && gameRunning && !paused) {
            osc.frequency.setTargetAtTime(42 + (speed * 6), audioCtx.currentTime, 0.1);
            gain.gain.setTargetAtTime(0.025, audioCtx.currentTime, 0.1);
        } else if (gain) gain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
    }

    // --- GELİŞMİŞ ÇİZİM FONKSİYONU ---
    function drawPixelCar(car) {
        const { x, y, w, h, model } = car;
        const drawP = (color, rx, ry, rw, rh) => { ctx.fillStyle = color; ctx.fillRect(x + rx, y + ry, rw, rh); };

        // Alt Gölge
        ctx.fillStyle = "rgba(0,0,0,0.5)"; ctx.fillRect(x + 5, y + 10, w, h);

        if (model === MODELS.SKYLINE) { // NISSAN SKYLINE R34
            drawP("#95a5a6", 2, 0, w-4, h); // Gövde
            drawP("#bdc3c7", 5, 2, w-10, h-12); // Parlama
            drawP("#2980b9", 11, 0, 6, h-10); drawP("#2980b9", w-17, 0, 6, h-10); // Mavi Şeritler
            drawP("#111", 6, 20, w-12, 18); // Cam
            
            // SPOILER (Kanat)
            drawP("#555", 8, h-16, 4, 10); drawP("#555", w-12, h-16, 4, 10); // Ayaklar
            drawP("#bdc3c7", -4, h-22, w+8, 7); // Üst Kanat
            drawP("#2980b9", -4, h-22, 6, 7); drawP("#2980b9", w-2, h-22, 6, 7); // Kanat uçları mavi
            
            // 4'lü Stoplar
            ["#e74c3c", "#c0392b"].forEach((c, i) => {
                drawP(c, 8, h-6, 5, 5); drawP(c, 16, h-6, 5, 5);
                drawP(c, w-13, h-6, 5, 5); drawP(c, w-21, h-6, 5, 5);
            });
        } 
        else if (model === MODELS.CHARGER) { // DODGE CHARGER
            drawP("#111", 0, 0, w, h); drawP("#2c3e50", 4, 4, w-8, h-15);
            drawP("#bdc3c7", w/2-9, 12, 18, 14); // Blower
            drawP("#7f8c8d", w/2-7, 10, 14, 4);
            drawP("#c0392b", 4, h-5, w-8, 4); // Stop
        }
        else if (model === MODELS.SUPRA) { // TOYOTA SUPRA
            drawP("#e67e22", 2, 0, w-4, h); drawP("#f39c12", 4, 5, w-8, h-20);
            drawP("#111", 4, 35, 3, 25); drawP("#111", w-7, 35, 3, 25); // Grafikler
            drawP("#111", 7, 20, w-14, 15); // Cam
            drawP("#d35400", -2, h-14, w+4, 8); // Spoiler
        }
        else if (model === MODELS.S2000) { // SUKI S2000
            drawP("#fd79a8", 2, 0, w-4, h); drawP("#f8a5c2", 6, 4, w-12, h-10);
            drawP("#111", 6, 28, w-12, 22); // İç mekan
            drawP("#fff", 6, 25, w-12, 3); // Ön cam
        }

        // Tekerlekler
        ctx.fillStyle = "#000";
        [14, h-24].forEach(ty => { ctx.fillRect(x-3, y+ty, 5, 18); ctx.fillRect(x+w-2, y+ty, 5, 18); });
    }

    function drawRoad() {
        ctx.fillStyle = "#0f0f0f"; ctx.fillRect(0,0,canvas.width, canvas.height);
        const rX = canvas.width/2 - ROAD_W/2;
        ctx.fillStyle = "#1a1a1a"; ctx.fillRect(rX, 0, ROAD_W, canvas.height);
        
        // Bordürler
        const kH = 35;
        for(let i=-frame%(kH*2); i<canvas.height; i+=kH){
            ctx.fillStyle = (Math.floor((i+frame)/kH)%2===0) ? "#e74c3c" : "#fff";
            ctx.fillRect(rX-12, i, 12, kH); ctx.fillRect(rX+ROAD_W, i, 12, kH);
        }

        // Şeritler
        ctx.strokeStyle = "rgba(255,255,255,0.15)"; ctx.setLineDash([50, 70]); 
        ctx.lineDashOffset = -frame * speed; ctx.lineWidth = 4;
        for(let i=1; i<LANES; i++){
            ctx.beginPath(); ctx.moveTo(rX + i*LANE_W, 0); ctx.lineTo(rX + i*LANE_W, canvas.height); ctx.stroke();
        }
    }

    // --- GAME ENGINE ---
    function update() {
        if (!gameRunning || paused) { updateSound(); if(gameRunning) requestAnimationFrame(update); return; }
        
        frame++; ctx.clearRect(0,0,canvas.width, canvas.height);
        drawRoad(); updateSound();

        // Smooth Lane Changing
        player.targetX = (canvas.width/2 - ROAD_W/2) + (player.lane * LANE_W) + (LANE_W/2 - player.w/2);
        player.currentX += (player.targetX - player.currentX) * 0.22;
        drawPixelCar({ ...player, x: player.currentX });

        // Spawn Enemies
        if(frame % Math.max(20, 55 - Math.floor(speed)) === 0){
            enemies.push({ 
                lane: Math.floor(Math.random()*LANES), 
                y: -120, w: 46, h: 84, 
                model: enemyPool[Math.floor(Math.random()*enemyPool.length)]
            });
        }

        enemies.forEach((en, i) => {
            en.y += speed;
            en.x = (canvas.width/2 - ROAD_W/2) + (en.lane * LANE_W) + (LANE_W/2 - en.w/2);
            drawPixelCar(en);

            // Collision Detection
            if(player.currentX < en.x+en.w-12 && player.currentX+player.w-12 > en.x &&
               player.y < en.y+en.h-12 && player.y+player.h-12 > en.y) gameOver();

            if(en.y > canvas.height){
                enemies.splice(i, 1); score++; scoreElement.innerText = "SCORE: " + score;
                if(score % 5 === 0) speed += 0.35;
            }
        });

        requestAnimationFrame(update);
    }

    // --- KONTROL ATAMALARI ---
    function setupInput(id, fn) {
        const el = document.getElementById(id);
        el.addEventListener("touchstart", (e)=>{ e.preventDefault(); fn(); });
        el.addEventListener("mousedown", (e)=>{ e.preventDefault(); fn(); });
    }
    setupInput("btnLeft", () => { if(gameRunning && !paused && player.lane > 0) player.lane--; });
    setupInput("btnRight", () => { if(gameRunning && !paused && player.lane < 2) player.lane++; });
    setupInput("btnPause", () => { if(gameRunning) { paused = !paused; msgElement.style.display = paused ? "block" : "none"; msgElement.innerText = "PAUSED"; }});
    
    window.addEventListener("keydown", (e) => {
        if(!gameRunning || paused) return;
        if(e.code === "ArrowLeft" && player.lane > 0) player.lane--;
        if(e.code === "ArrowRight" && player.lane < 2) player.lane++;
        if(e.code === "KeyP") document.getElementById("btnPause").click();
    });

    function startGame() {
        if(!gameRunning) { if(!audioCtx) initSound(); reset(); gameRunning = true; update(); }
        else if(paused) { paused = false; msgElement.style.display = "none"; }
    }
    function reset() { 
        score = 0; speed = 9; enemies = []; player.lane = 1; 
        msgElement.style.display = "none"; scoreElement.innerText = "SCORE: 0"; 
    }
    function gameOver() { 
        gameRunning = false;
        if(score > topScore) {
            topScore = score;
            localStorage.setItem("matGames_topScore", topScore);
            highScoreElement.innerText = "TOP SCORE: " + topScore;
        }
        msgElement.style.display = "block"; 
        msgElement.innerText = "CRASHED! RESTART"; 
    }

    drawRoad(); drawPixelCar({...player, x: (canvas.width/2 - ROAD_W/2) + (1 * LANE_W) + (LANE_W/2 - player.w/2)});
</script>
</body>
</html>
